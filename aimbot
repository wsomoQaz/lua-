local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- GUI初始化
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "AimbotMobileUI"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 160, 0, 100)
main.Position = UDim2.new(0, 50, 0, 100)
main.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
main.Active = true
main.Draggable = true

local toggle = Instance.new("TextButton", main)
toggle.Size = UDim2.new(1, 0, 0, 40)
toggle.Position = UDim2.new(0, 0, 0, 0)
toggle.Text = "打开Aimbot"
toggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
toggle.TextColor3 = Color3.new(1, 1, 1)

local fold = Instance.new("TextButton", main)
fold.Size = UDim2.new(1, 0, 0, 25)
fold.Position = UDim2.new(0, 0, 1, -25)
fold.Text = "折叠"
fold.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
fold.TextColor3 = Color3.new(1, 1, 1)

local label = Instance.new("TextLabel", gui)
label.Size = UDim2.new(0, 250, 0, 40)
label.Position = UDim2.new(0.5, -125, 0.1, 0)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.fromRGB(255, 50, 50)
label.Text = ""
label.TextScaled = true
label.Visible = false

-- 状态控制
local aimbotActive = false
local lockedHead = nil

-- 获取最近玩家头部
local function GetNearestHead()
	local closestHead = nil
	local shortestDist = math.huge

	for _, target in pairs(Players:GetPlayers()) do
		if target ~= LocalPlayer and target.Character and target.Character:FindFirstChild("Head") then
			local head = target.Character.Head
			local dist = (Camera.CFrame.Position - head.Position).Magnitude
			if dist < shortestDist then
				shortestDist = dist
				closestHead = head
			end
		end
	end
	return closestHead
end

-- 每帧强制瞄准
RunService.RenderStepped:Connect(function()
	if aimbotActive then
		if not lockedHead or not lockedHead:IsDescendantOf(workspace) then
			lockedHead = GetNearestHead()
		end

		if lockedHead then
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, lockedHead.Position)
			local playerName = lockedHead.Parent and lockedHead.Parent.Name or "???"
			label.Text = "锁定目标：" .. playerName
			label.Visible = true
		else
			label.Visible = false
		end
	end
end)

-- 切换开关
toggle.MouseButton1Click:Connect(function()
	aimbotActive = not aimbotActive
	toggle.Text = aimbotActive and "关闭Aimbot" or "打开Aimbot"
	toggle.BackgroundColor3 = aimbotActive and Color3.fromRGB(200, 50, 50) or Color3.fromRGB(60, 180, 60)
	if not aimbotActive then
		label.Visible = false
		lockedHead = nil
	end
end)

-- 折叠按钮
local isFolded = false
fold.MouseButton1Click:Connect(function()
	isFolded = not isFolded
	toggle.Visible = not isFolded
	fold.Text = isFolded and "展开" or "折叠"
	main.Size = isFolded and UDim2.new(0, 160, 0, 25) or UDim2.new(0, 160, 0, 100)
end)