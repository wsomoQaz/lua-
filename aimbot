local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Workspace = game:GetService("Workspace")

-- 创建GUI
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "AimbotMobileUI"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 220, 0, 90)
main.Position = UDim2.new(0, 50, 0, 100)
main.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
main.Active = true
main.Draggable = true

local toggle = Instance.new("TextButton", main)
toggle.Size = UDim2.new(1, 0, 0, 40)
toggle.Position = UDim2.new(0, 0, 0, 0)
toggle.Text = "打开自动锁定"
toggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
toggle.TextColor3 = Color3.new(1, 1, 1)

local label = Instance.new("TextLabel", main)
label.Size = UDim2.new(1, 0, 0, 40)
label.Position = UDim2.new(0, 0, 0, 45)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.fromRGB(255, 50, 50)
label.Text = ""
label.TextScaled = true

local aimbotActive = false
local lockedHead = nil
local lockedPlayerName = nil

local function isPlayerAlive(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid and humanoid.Health > 0 then
        return true
    end
    return false
end

local function findClosestHead()
    local character = LocalPlayer.Character
    if not character then return nil end
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return nil end

    local origin = hrp.Position
    local closestHead = nil
    local closestDistance = math.huge
    local closestName = nil

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local char = player.Character
            if isPlayerAlive(char) then
                local head = char:FindFirstChild("Head")
                if head then
                    local dist = (head.Position - origin).Magnitude
                    if dist < closestDistance then
                        closestDistance = dist
                        closestHead = head
                        closestName = player.Name
                    end
                end
            end
        end
    end

    return closestHead, closestName
end

RunService.RenderStepped:Connect(function()
    if aimbotActive then
        -- 如果当前锁定无效，寻找新目标
        if not lockedHead or not lockedHead.Parent or not isPlayerAlive(lockedHead.Parent) then
            local head, pname = findClosestHead()
            lockedHead = head
            lockedPlayerName = pname
        end

        if lockedHead then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, lockedHead.Position)
            label.Text = "锁定目标: " .. lockedPlayerName
            label.Visible = true
        else
            label.Text = "无可锁定玩家"
            label.Visible = true
        end
    else
        label.Visible = false
        lockedHead = nil
        lockedPlayerName = nil
    end
end)

toggle.MouseButton1Click:Connect(function()
    aimbotActive = not aimbotActive
    if aimbotActive then
        toggle.Text = "关闭自动锁定"
        toggle.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    else
        toggle.Text = "打开自动锁定"
        toggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
        label.Visible = false
        lockedHead = nil
        lockedPlayerName = nil
    end
end)