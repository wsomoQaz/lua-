local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

-- 创建主界面
local ScreenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
ScreenGui.Name = "AimbotGui"
ScreenGui.ResetOnSpawn = false

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 150, 0, 100)
Frame.Position = UDim2.new(0, 100, 0, 100)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Active = true
Frame.Draggable = true

local ToggleButton = Instance.new("TextButton", Frame)
ToggleButton.Size = UDim2.new(1, 0, 0, 30)
ToggleButton.Text = "启用Aimbot"
ToggleButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
ToggleButton.TextColor3 = Color3.new(1, 1, 1)

local FoldButton = Instance.new("TextButton", Frame)
FoldButton.Size = UDim2.new(1, 0, 0, 25)
FoldButton.Position = UDim2.new(0, 0, 1, -25)
FoldButton.Text = "折叠"
FoldButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
FoldButton.TextColor3 = Color3.new(1, 1, 1)

local NameLabel = Instance.new("TextLabel", ScreenGui)
NameLabel.Size = UDim2.new(0, 200, 0, 40)
NameLabel.Position = UDim2.new(0.5, -100, 0.1, 0)
NameLabel.Text = ""
NameLabel.BackgroundTransparency = 1
NameLabel.TextColor3 = Color3.new(1, 0, 0)
NameLabel.TextScaled = true
NameLabel.Visible = false

-- 状态变量
local AimbotEnabled = false
local LockedTarget = nil
local Folded = false

-- 查找最近玩家（非自己）
local function GetClosestTarget()
	for _, target in pairs(Players:GetPlayers()) do
		if target ~= LocalPlayer and target.Character and target.Character:FindFirstChild("Head") then
			local head = target.Character.Head
			local dist = (Camera.CFrame.Position - head.Position).Magnitude
			if not LockedTarget or dist < (Camera.CFrame.Position - LockedTarget.Position).Magnitude then
				LockedTarget = head
				NameLabel.Text = "锁定：" .. target.Name
				NameLabel.Visible = true
			end
		end
	end
end

-- 每帧锁定追踪
RunService.RenderStepped:Connect(function()
	if AimbotEnabled then
		if not LockedTarget or not LockedTarget:IsDescendantOf(Workspace) then
			LockedTarget = nil
			NameLabel.Visible = false
			GetClosestTarget()
		end
		if LockedTarget then
			local newCFrame = CFrame.new(Camera.CFrame.Position, LockedTarget.Position)
			Camera.CFrame = newCFrame
		end
	end
end)

-- 启用/关闭 Aimbot
ToggleButton.MouseButton1Click:Connect(function()
	AimbotEnabled = not AimbotEnabled
	ToggleButton.Text = AimbotEnabled and "关闭Aimbot" or "启用Aimbot"
	ToggleButton.BackgroundColor3 = AimbotEnabled and Color3.fromRGB(200, 50, 50) or Color3.fromRGB(50, 200, 50)

	if not AimbotEnabled then
		LockedTarget = nil
		NameLabel.Visible = false
	end
end)

-- 折叠功能
FoldButton.MouseButton1Click:Connect(function()
	Folded = not Folded
	if Folded then
		ToggleButton.Visible = false
		FoldButton.Text = "展开"
		Frame.Size = UDim2.new(0, 150, 0, 25)
	else
		ToggleButton.Visible = true
		FoldButton.Text = "折叠"
		Frame.Size = UDim2.new(0, 150, 0, 100)
	end
end)