local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- 创建GUI
local gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
gui.Name = "AimbotMobileUI"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 220, 0, 180)
main.Position = UDim2.new(0, 50, 0, 100)
main.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
main.Active = true
main.Draggable = true

local toggle = Instance.new("TextButton", main)
toggle.Size = UDim2.new(1, 0, 0, 40)
toggle.Position = UDim2.new(0, 0, 0, 0)
toggle.Text = "打开Aimbot"
toggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
toggle.TextColor3 = Color3.new(1, 1, 1)

local fold = Instance.new("TextButton", main)
fold.Size = UDim2.new(1, 0, 0, 25)
fold.Position = UDim2.new(0, 0, 1, -25)
fold.Text = "折叠"
fold.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
fold.TextColor3 = Color3.new(1, 1, 1)

local nameInput = Instance.new("TextBox", main)
nameInput.Size = UDim2.new(1, -20, 0, 30)
nameInput.Position = UDim2.new(0, 10, 0, 50)
nameInput.PlaceholderText = "输入玩家名字部分匹配"
nameInput.ClearTextOnFocus = false
nameInput.Text = ""
nameInput.TextColor3 = Color3.new(1,1,1)
nameInput.BackgroundColor3 = Color3.fromRGB(60,60,60)
nameInput.TextScaled = true

local label = Instance.new("TextLabel", gui)
label.Size = UDim2.new(0, 250, 0, 40)
label.Position = UDim2.new(0.5, -125, 0.1, 0)
label.BackgroundTransparency = 1
label.TextColor3 = Color3.fromRGB(255, 50, 50)
label.Text = ""
label.TextScaled = true
label.Visible = false

-- 状态
local aimbotActive = false
local lockedHead = nil
local lockedName = nil

local function findPlayerByNamePart(namePart)
    local lowerNamePart = namePart:lower()
    for _, p in pairs(Players:GetPlayers()) do
        local lowerPlayerName = p.Name:lower()
        if string.find(lowerPlayerName, lowerNamePart, 1, true) then
            if p.Character and p.Character:FindFirstChild("Head") then
                return p.Character.Head, p.Name
            end
        end
    end
    return nil, nil
end

RunService.RenderStepped:Connect(function()
    if aimbotActive and lockedHead and lockedHead.Parent then
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, lockedHead.Position)
        label.Text = "锁定目标：" .. (lockedName or "???")
        label.Visible = true
    else
        if aimbotActive and lockedName then
            local head, pname = findPlayerByNamePart(lockedName)
            if head then
                lockedHead = head
                lockedName = pname
                label.Text = "锁定目标：" .. pname
                label.Visible = true
            else
                lockedHead = nil
                label.Text = "找不到玩家: " .. lockedName
                label.Visible = true
            end
        else
            label.Visible = false
        end
    end
end)

toggle.MouseButton1Click:Connect(function()
    if not aimbotActive then
        local inputName = nameInput.Text
        if inputName ~= "" then
            local head, pname = findPlayerByNamePart(inputName)
            if head then
                lockedHead = head
                lockedName = pname
            else
                lockedHead = nil
                lockedName = inputName
            end
        else
            lockedHead = nil
            lockedName = nil
        end
        aimbotActive = true
        toggle.Text = "关闭Aimbot"
        toggle.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    else
        aimbotActive = false
        lockedHead = nil
        lockedName = nil
        toggle.Text = "打开Aimbot"
        toggle.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
    end
end)

fold.MouseButton1Click:Connect(function()
    if main.Size.Y.Offset > 50 then
        main.Size = UDim2.new(0, 220, 0, 50)
        fold.Text = "展开"
        nameInput.Visible = false
        toggle.Visible = false
    else
        main.Size = UDim2.new(0, 220, 0, 180)
        fold.Text = "折叠"
        nameInput.Visible = true
        toggle.Visible = true
    end
end)